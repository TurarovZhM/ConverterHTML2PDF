<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="search/image/favicon.ico">
<title>GeometryOperations</title>
<link href="search/css/bootstrap.css" rel="stylesheet">
<link href="search/css/fraunhofer.css" rel="stylesheet">
<script type="text/javascript" src="search/js/jquery-1.12.0.js"></script>
<script src="search/js/bootstrap.min.js"></script>
<script src="search/js/custom.js"></script>
</head>
<body>
	<div class="fh-wrapper">
		<div class="header">
			<div class="row visible-xs" id="main-menu-top">
				    <div class="row search-nav-icon">
					    <div class="col-md-12">
					<!-- for search and navigation icon -->
						  <div id="nav-top" class="nav-top-btn"></div>
						  <div id="search-btn-index-top-icon" class="search-icon"></div>
					    </div>
				    </div>
				    <div class="row">
				      <div class="col-md-12">
					    <nav class="navbar navbar-inverse">
						    <div class="navbar-header">
						      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						      </button>
						    </div>
							<div id="navbar" class="navbar navbar-light bg-faded collapse navbar-collapse">
							  <ul class="nav navbar-nav">
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.InputFiles.html" target="_blank">Input Files</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Indices.html" target="_blank">Indices</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.GettingStarted.html" target="_blank">Getting Started</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Download.html" target="_blank">Download</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Support.html" target="_blank">Support</a>
								</li>
							  </ul>
							</div>
					      </nav>
					</div>
				      <div class="search-top">
					      <form id="search-form-index-top" >
						  <input type="text" name="queryString" id="search-text-index-top" value="" autocomplete="off" placeholder="Search" class="query-string"/>
						  <button type="submit" class="btn" id="search-btn-index-top"></button>
					      </form>
				    </div>
				</div>
			</div>
			<div class="row header-row">
				<div class="col-sm-4">
					<div class="row">
					   <a href="MESHFREE.html">
						  <img class="logo img-responsive" alt="" src="search/image/MESHFREE_Logo.png"/>
					   </a>
					</div>
					<div class= "row company_name">
						Simulate with complex geometries and complex physics
					</div>
				</div>
				<div class="col-sm-8">
					<div class="row header-search-row hidden-xs">
						<div class="search">
						  <form id="search-form-index-header" >
						      <input type="text" name="queryString" id="search-text-index-header" value="" autocomplete="off" placeholder="Search" class="query-string"/>
						      <button type="submit" class="btn" id="search-btn-index-header"><i class="glyphicon glyphicon-search"></i></button>
						  </form>
						</div>
					</div>
					<div class="row main_menu hidden-xs" id="main-menu-bottom">
					  <nav class="navbar navbar-inverse">
						<div class="navbar-header">
						  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						    <span class="sr-only">Toggle navigation</span>
						    <span class="icon-bar"></span>
						    <span class="icon-bar"></span>
						    <span class="icon-bar"></span>
						  </button>
						</div>
							<div id="navbar" class="navbar navbar-light bg-faded collapse navbar-collapse">
							  <ul class="nav navbar-nav">
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.InputFiles.html" target="_blank">Input Files</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Indices.html" target="_blank">Indices</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.GettingStarted.html" target="_blank">Getting Started</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Download.html" target="_blank">Download</a>
								</li>
								<li class="nav-item">
								  <a class="nav-link" href="MESHFREE.Support.html" target="_blank">Support</a>
								</li>
							  </ul>
							</div>
					  </nav>
					</div>
				</div>
			</div>
		</div>
     <div class="breadcrumbs">
	  <div class="row breadcrumb">
	    <div class="col-md-12">
		<ul>
<li><a href="MESHFREE.html">MESHFREE</a></li>
<li><a href="MESHFREE.PerformanceOptimization.html">PerformanceOptimization</a></li>
<li><a href="MESHFREE.PerformanceOptimization.GeometryOperations.html">GeometryOperations</a></li>
		</ul>
	    </div>
	  </div>
	</div>
		<div class="border-vertical">
		  <div class="row">
		    <div class="col-md-12 content">
		    	<div class="jumbotron">
<h1>GeometryOperations</h1><p> performance optimization concerning geometry operations </p>
		    	</div>
			<div class="description">
                                                                                                                         
   
 We list here the recent performance developments. The new algorithms run under version 3, the pervious ones under version 2, see below. 
   
 <span style="color:green"> In order to judge on his own, the user is invited to check based on the <a href="MESHFREE.InputFiles.common_variables.COMP_TimeCheck.html">COMP_TimeCheck</a> functinality, considering the here mentioned stop watches. </span> 
   
 <span style="color:blue"> Two examples have been carried out inorder to check the performance improvements: 
 <ul><li> 
 </li><li> <b>Example 1</b>: simple box in channel case, see <a href="MESHFREE.GettingStarted.SpecialCases.WaterCrossing.SimpleBox.Classical.html">Classical</a> with 80000 <a href="MESHFREE.html">MESHFREE</a> points on 4 MPI processes. Here, free surfaces, active boundary etc. are nicely distributed among the MPI-processes. 
 </li><li> <b>Example 2</b>: sophisticated water crossing of real car geometry, 5.4 Mio <a href="MESHFREE.html">MESHFREE</a> points, 192 MPI processes. Here, free surfaces and active boundaries are absolutely NOT load-balanced, such the (see below) the performance is less optimal. 
 </li></ul> </span> 
   
   
 <img src= ../Pictures/performanceWaterCrossing_V2_vs_V3.png alt="Here should be a picture" class="img-responsive"> 
 The picture shows the speedup of the performance for the various ORGANIZE-tasks version 3 compared to different options of version 2 for the above mentioned <b>example 2</b>. 
 The time statistics include the MPI-bisection, even though that operation is performed ever 5 timesteps, only. 
 <ul><li> 
 </li><li> <b>movement of geometry</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.ORGANIZE_USER_update_boundary_particles_Version.html">ORGANIZE_USER_update_boundary_particles_Version</a> = 3 <span style="color:#FACC2E;"># This option allows for shared memory as well as </span>
 <span style="color:#FACC2E;">#                                                   # performancy boost for static geometries (BE with <a href="MESHFREE.InputFiles.USER_common_variables.__overview_of_syntax_elements__.begin_alias{.MOVE.html">MOVE</a>-1 are not considered for movement) </span>
 
 </div> </div> 
 previous standard was 2. 
   
 Version 3 basically cuts down the computation time for geometry movement by one order of magnitude, as the CPU of a <a href="MESHFREE.InputFiles.common_variables.CONTROL_DirectTesting.SharedMemory.html">SharedMemory</a>-block also 
 share the effort for geometry movement. In version 3, we compute the rotation matrix <span lang="latex-inline"><img src="1672e61c87c8201e961b6439c8b5b7ef.png" alt=" \mathbf{M}_{rot}^{n+1}" class="latex" border="0"></span> and the translation 
 vector <span lang="latex-inline"><img src="f5a9db3aef514c74d737bcbbef756b85.png" alt=" \mathbf{b}_{trans}^{n+1}" class="latex" border="0"></span> such that the movement from the old to the new position of a geometry node is computed by 
 <div lang="latex"><img src="06d027aa738b43d9a641f926b0a1fe02.png" alt=" \mathbf{x}_i^{n+1} = \mathbf{M}_{rot}^{n+1} \cdot \mathbf{x}_i^{n} + \mathbf{b}_{trans}^{n+1}" class="latex" border="0"></div> 
 For any rigid body movement, the translation and rotation items are unique, so the matrix and vector does not have to be recomputed for any 
 geometry point. Thus, please also apply the option <a href="MESHFREE.InputFiles.USER_common_variables.MOVE.%25MOVE_InvokeDataCaching%25.html">%MOVE_InvokeDataCaching%</a> in order to avoid unnecessary recomputation of <span lang="latex-inline"><img src="1672e61c87c8201e961b6439c8b5b7ef.png" alt=" \mathbf{M}_{rot}^{n+1}" class="latex" border="0"></span> and <span lang="latex-inline"><img src="f5a9db3aef514c74d737bcbbef756b85.png" alt=" \mathbf{b}_{trans}^{n+1}" class="latex" border="0"></span>. 
   
 <span style="color:green"> <div class="code"> 
 -> <b>stopwatch</b>: ADMIN_TIME_INTEG.ORGANIZE.BE_Movement </div> </span> 
   
 <span style="color:blue"> <div class="code"> 
 -> <b>SPEEDUP</b> (version 3 compared to version 2): 
 <ul><li> 
 </li><li> If <a href="MESHFREE.InputFiles.USER_common_variables.__overview_of_syntax_elements__.begin_alias{.MOVE.html">MOVE</a>-1 is used, or equally <a href="MESHFREE.InputFiles.USER_common_variables.__overview_of_syntax_elements__.begin_alias{.MOVE.html">MOVE</a>($...$) = (%MOVE_none%,...), then these boundary elements are not considered for movement, thus they do not require simulation time. In version 2, even these boundary elements were processed in every time step. 
 </li><li> If using <a href="MESHFREE.InputFiles.common_variables.COMP_SharedMemoryForBE.html">COMP_SharedMemoryForBE</a> = true, then the workload for boundary element movement is distributed evenly among the shared processes 
 </li></ul> 
 Thus, the speedup opportunities are tremendous with version 3. </div> </span> 
   
   
   
 </li><li> <b>neighbor list production</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_EstablishCON_Version.html">GEOTREE2_EstablishCON_Version</a> = 3     <span style="color:#FACC2E;"># After establishing the tree for neighbor search, <a href="MESHFREE.html">MESHFREE</a> installs the neighbor lists for each point </span>
 <span style="color:#FACC2E;">#                                     # The way of neighbor list installation has impact on the performance. </span>
 
 </div> </div> 
 The previous standard is 2. 
   
 <span style="color:red"> REMARK: numbering different until version 18.11.0: 2(old) -> 1(new); 3(old) -> 2(new); 1(old) -> 3(new) </span> 
   
 <span style="color:green"> <div class="code"> 
 -> <b>stopwatches</b>: ADMIN_TIME_INTEG.ORGANIZE.COMMUNICATION.NEIGHLIST + ADMIN_TIME_INTEG.ORGANIZE.EstablishCON    </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  1.00E-05 s/p     1.05E-05 s/p 
 .           version 2:  2.30E-05 s/p     2.51E-05 s/p 
 </span> </div> 
   
   
 Also, it might be a good idea to study the performance on the local machine architecture. On the native Fraunhofer-cluster, for example, 
 optimal values for the tree design were found to be 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_FinalBoxSize.html">GEOTREE2_FinalBoxSize</a> = 24 
 <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_MaximumBoxSize.html">GEOTREE2_MaximumBoxSize</a> = 32 
 <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_IntListMargin.html">GEOTREE2_IntListMargin</a> = 8 
 
 </div> </div> 
 The previous standard was 4 / 8 / 4 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.45E-05 s/p     0.48E-05 s/p 
 .           version 2:  1.10E-05 s/p     0.97E-05 s/p 
 </span> </div> 
   
 </li><li> <b>neighbor list reduction</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.NEIGHBOR_FilterMethod.html">NEIGHBOR_FilterMethod</a> = 3             <span style="color:#FACC2E;"># after establishing the neighborlist for each point, reduce those neighbors from the list </span>
 <span style="color:#FACC2E;">#                                     # the rays of which pass through the boundary </span>
 
 </div> </div> 
 The previous standard was 1 or 2. 
   
 <span style="color:green"> <div class="code"> 
 -> <b>stopwatch</b>: ADMIN_TIME_INTEG.ORGANIZE.NEIGHBORLISTREDUCTION.CC2    </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.30E-05 s/p     0.45E-05 s/p 
 .           version 2:  0.45E-05 s/p     0.47E-05 s/p 
 </span> </div> 
   
   
 </li><li> <b>neighbor list sorting</b> 
 Neighborlist sorting is necessary in order to select the closest N neighbors, given by the parameter max_N_stencil . 
 For defining the version of neighbor list sorting, have to set the second item in the parameter <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_EstablishCON_Version.html">GEOTREE2_EstablishCON_Version</a> : 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.GEOTREE2_EstablishCON_Version.html">GEOTREE2_EstablishCON_Version</a> = (3,3) <span style="color:#FACC2E;"># After the establishing the tree for neighor search, <a href="MESHFREE.html">MESHFREE</a> installs the neighbor lists for each point. </span>
 <span style="color:#FACC2E;">#                                     # The way of neighbor list installation has impact on the performance. </span>
 
 </div> </div> 
 The previous standard was 2. 
   
 <span style="color:red"> REMARK: not active until version 18.11.0 </span> 
   
 <span style="color:green"> <div class="code"> 
 -> <b>stopwatch</b>: ADMIN_TIME_INTEG.ORGANIZE.NEIGHBORLISTREDUCTION.ONL    </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.31E-05 s/p     0.17E-05 s/p 
 .           version 2:  0.75E-05 s/p     0.41E-05 s/p 
 </span> </div> 
   
   
 </li><li> <b>detection of free surface points</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.ORGANIZE_CheckFreeSurface_Version.html">ORGANIZE_CheckFreeSurface_Version</a> = 3 <span style="color:#FACC2E;"># </span>
 
 </div> </div> 
 The previous standard and current default is 2. 
   
 <span style="color:green"> <div class="code"> 
 -> stopwatch: ADMIN_TIME_INTEG.ORGANIZE.CHECK_FREE_SURFACE    </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.55E-05 s/p     0.14E-04 s/p 
 .           version 2:  1.48E-05 s/p     0.41E-04 s/p 
 </span> </div> 
   
 </li><li> <b>activation of boundary points</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.ORGANIZE_ActivateBNDpoints_Version.html">ORGANIZE_ActivateBNDpoints_Version</a> = 3 <span style="color:#FACC2E;"># </span>
 
 </div> </div> 
 The previous standard and current default is 2. 
   
 <span style="color:green"> <div class="code"> 
 -> stopwatch: ADMIN_TIME_INTEG.ORGANIZE.ACTIVATE_BND    </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.62E-05 s/p     0.11E-04 s/p 
 .           version 2:  1.37E-05 s/p     0.23E-04 s/p 
 </span> </div> 
   
   
 </li><li> <b>computation of distance to boundary for all points</b> 
 <div class="note"> <div class="code"> 
 <a href="MESHFREE.InputFiles.common_variables.ORGANIZE_DistanceToBoundary_Version.html">ORGANIZE_DistanceToBoundary_Version</a> = 3 
 
 </div> </div> 
 The previous standard and current default is 2. 
   
 <span style="color:green"> <div class="code"> 
 -> stopwatch: ADMIN_TIME_INTEG.ORGANIZE.DIST_TO_BND     </div> </span> 
   
 <div class="code"> <span style="color:blue"> 
 -> <b>SPEEDUP</b>:             example 1        example 2 
 .           version 3:  0.15E-05 s/p     0.12E-04 s/p 
 .           version 2:  0.75E-05 s/p     0.31E-04 s/p 
 </span> </div> 
   
 </li></ul> 
     
	      			</div>
	      		</div>
		</div>
	</div>
<div class="blank-class-outer footer visible-md visible-lg">
  <div class="border-vertical">
    <div class="row">
	      <div class="col-md-6">
		      <a href="http://itwm.fraunhofer.de" target="_blank">&copy 2020 Fraunhofer Institute for Industrial Mathematics ITWM</a>
	      </div>
	      <div class="col-md-2 footer-border-left">
			<a href="Index.html" target="_blank">Index</a>
	      </div>
	      <div class="col-md-2 footer-border-left">
			<a href="MESHFREE.Releases.html" target="_blank">Releases</a>
	      </div>
	      <div class="col-md-2 footer-border-left">
			<a href="https://svn.itwm.fraunhofer.de/svn/MESHFREEdocu/Executables/" target="_blank">Executables</a>
	      </div>
      </div>
    </div>
  </div>
  <div class="footer-small visible-xs visible-sm">
    <div class="blank-class-outer">
      <div class="blank-class-inner">
	<div class="row ">
		<div class="col-md-12">
			<a href="Index.html" target="_blank">Index</a>
	      </div>
	</div>
      </div>
    </div>
    <div class="blank-class-outer-bottom">
      <div class="blank-class-inner">
	<div class="row ">
	      <div class="col-md-12">
		      <a href="MESHFREE.Releases.html" target="_blank">Releases</a>
	      </div>
	</div>
      </div>
    </div>
    <div class="blank-class-outer-bottom">
      <div class="blank-class-inner">
	<div class="row ">
	      <div class="col-md-12">
		      <a href="https://svn.itwm.fraunhofer.de/svn/MESHFREEdocu/Executables/" target="_blank">Executables</a>
	      </div>
	</div>
      </div>
    </div>
    <div class="blank-class-outer-left-right">
      <div class="blank-class-inner">
	<div class="row ">
	      <div class="col-md-12">
		      <a href="http://itwm.fraunhofer.de" target="_blank">&copy 2020 Fraunhofer Institute for Industrial Mathematics ITWM</a>
	      </div>
	</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
